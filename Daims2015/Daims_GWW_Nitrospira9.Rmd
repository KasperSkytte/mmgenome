---
title: "Analysis - Daims Nitrospira 9 GWW assembly"
author: "Mads Albertsen"
date: "November 24, 2015"
output: html_document
---
## Introduction
This report documents the binning of a Nitrospira genome from the GWW sample. See [Daims et al., 2015: Complete Nitrification by Nitrospira Bacteria](https://doi.org/10.1038/nature16461) for further details.

## Load the mmgenome package
The metagenome data is analysed using the [mmgenome package](http://madsalbertsen.github.io/mmgenome/).
```{r Load_package, message=FALSE, warning=FALSE, results='hide'}
library("mmgenome")
```

## Import data
The Rmarkdown file [Load_data.Rmd](http://madsalbertsen.github.io/mmgenome/Daims_GWW_Load_data.html) describes the loading of the data and can be imported using the `mmimport` function. However, the preprocessed data can also be downloaded directly from figshare: [Daims_GWW](http://dx.doi.org/10.6084/m9.figshare.1613284). Hence, here we import the prepocessed data from figshare instead.
```{r Load_data, message=FALSE, warning=FALSE, results='hide'}
load("Daims_GWW.RData")
```

## Extract Nitrospira 9
As seen from the overview plots, there are numerous Nitrospira species. This one is located between multiple other species.
```{r zoomA, fig.width=12, fig.height=10, fig.align='center', message=FALSE, warning=FALSE}
p <- mmplot(data = d,
            x = "HPD", 
            y = "HPF1", 
            log.x = T, 
            log.y = T, 
            color = "essential", 
            minlength = 5000, 
            factor.shape = "solid") +
  scale_x_log10(limits=c(2, 30)) +
  scale_y_log10(limits=c(5, 50))

#p
#sel <- mmplot_locator(p)

sel <- data.frame(HPD  =  c(9.24, 9.46, 13.1, 18, 23.7, 18.2, 11.1, 9.14),
                  HPF1  =  c(11.3, 9.72, 9.24, 11.6, 18.3, 20.1, 14, 11.4))

mmplot_selection(p, sel)
```

The scaffolds included in the defined subspace are extracted using the `mmextract` function. 
```{r extractA}
dA <- mmextract(d, sel)
```

The `mmstats` function applies to any extracted object. Hence, it can be used directly on the subset.
```{r statsA}
mmstats(dA, ncov = 2)
```

```{r pairsA, fig.width=12, fig.height=10, fig.align='center'}
mmplot_pairs(data = dA, 
             variables = c("HPD", "HPF1","gc", "PC1", "PC2", "PC3"), 
             minlength = 5000, 
             color = "essential")
```

## Clean-up other species (Subset B)
We do a another selection to remove other Nitrospira scaffolds that were included.
```{r zoomB, fig.width=12, fig.height=10, fig.align='center', message=FALSE, warning=FALSE}
p <- mmplot(data = dA,
            x = "PC1", 
            y = "PC3", 
            color = "essential", 
            minlength = 1000)

#p
#sel <- mmplot_locator(p)

sel <- data.frame(PC1  =  c(-0.0373, 0.00392, 0.0672, 0.103, 0.0947, 0.0306, -0.0327),
                  PC3  =  c(0.0607, 0.146, 0.147, 0.0574, -0.0104, -0.0138, 0.0171))

mmplot_selection(p, sel)
```

The scaffolds included in the defined subspace are extracted using the `mmextract` function. 
```{r extractB}
dB <- mmextract(dA, sel)
```

The `mmstats` function applies to any extracted object. Hence, it can be used directly on the subset.
```{r statsB}
mmstats(dB, ncov = 2)
```

## Export the scaffolds
Finally the binned scaffolds are exported.
```{r export}
mmexport(data = dB, assembly = assembly, file = "GWW_Nitrospira9.fa")
```