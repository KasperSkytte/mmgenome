---
title: "Load Data - Holmes"
author: "Mads Albertsen"
date: "June 28, 2016"
output: html_document
---

## Load the mmgenome packages

In case you havn't installed all the needed packages, they can be installed via e.g. `install_github("MadsAlbertsen/mmgenome/mmgenome")`.
```{r Load_packages, message=F,warning=FALSE}
library("mmgenome")
options(scipen = 8)
```

## Load data
The assembly of the `Holmes` metagenome in fasta format is loaded in fasta format using the Biostrings package.

```{r load_assembly, message=F,warning=FALSE}
assembly <- readDNAStringSet("data/assembly.fa", format = "fasta")
```

The coverage data is loaded. Note that each coverage dataset must have the scaffold name in the first column and the coverage in the second coloumn. The name of each coverage dataset reflect when the data was sampled.
```{r load_coverage, message=F,warning=FALSE}
H09.06 <- read.csv("data/H09.06.csv", header = T)[,c("Reference.sequence","Average.coverage")]               
H11.05 <- read.csv("data/H11.05.csv", header = T)[,c("Reference.sequence","Average.coverage")]                 
H11.25 <- read.csv("data/H11.25.csv", header = T)[,c("Reference.sequence","Average.coverage")]
H12.13 <- read.csv("data/H12.13.csv", header = T)[,c("Reference.sequence","Average.coverage")]                 
H12.19 <- read.csv("data/H12.19.csv", header = T)[,c("Reference.sequence","Average.coverage")]    
```

The overview of the number of essential genes in each scaffold is loaded.
```{r load_essential, message=F,warning=FALSE}
ess <- read.table("data/essential.txt", header = T)
```

Load basic taxonomy of the scaffolds. Only scaffolds with essential genes are taxonomic classified.
```{r load_tax, message=F,warning=FALSE}
tax <- read.delim("data/tax.txt", header = T)
```

Load information on which scaffolds that are connected by paired-end (PE) and mate-pair (MP) connections.
```{r load_network, message=F,warning=FALSE}
pe <- read.delim("data/network_pe.txt", header = T)
mp <- read.delim("data/network_mp.txt", header = T)
```

Additional: 16S rRNA information.
```{r load_additional_16S, message=F,warning=FALSE}
rRNA16S <- read.delim("data/16S.txt", header = T)
```

Additional: All metagenome scaffolds were taxonomically classified using [PhyloPythiaS+](http://arxiv.org/abs/1406.7123). The original output file is slightly modified after being loaded.
```{r Load_Additional_pps, message=F,warning=FALSE}
pps <- read.table("data/pps.txt", sep = "\t", header = F, col.names = c("scaffold","pps_root", "pps_kingdom", "pps_phylum", "pps_class", "pps_order", "pps_family", "pps_genus", "pps_species"))[,c(1,4,5,6,7,8)]
pps[pps == ""] <- NA
```

## Merge data

The loaded data is merged to a single object `d`. The assembly is used to extract scaffold length, GC content and tetranucleotide frequencies, which are used for a simple PCA. The `tax.expand` parameter converts a phylum level taxonomic classification to the underlying classes instead. The `tax.freq` parameter removes any classification with less than 50 entries in the complete dataset. The `other` parameter can be used to load any additional datasets.

```{r Merge_d1, message=F,warning=FALSE}
d <- mmload(assembly = assembly, 
           coverage = c("H09.06", "H11.05", "H11.25", "H12.13", "H12.19"), 
           tax = tax,
           essential = ess,
           tax.expand = "Proteobacteria",
           tax.freq = 50,
           other = c("rRNA16S", "pps")
           )
```

## Save data
Remove temporary data and save the generated data for easy loading.
```{r remove, message=F,warning=FALSE}
rm(list = c("H09.06", "H11.05", "H11.25", "H12.13", "H12.19", "ess", "tax", "rRNA16S", "pps"))
save.image(file="Holmes.RData")
```